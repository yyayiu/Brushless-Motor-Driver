#include "trigon_math.h"

static const int32_t tan_table[257] = {0, 101, 201, 302, 402, 503, 603, 704, 805, 906, 1007, 1108, 1209, 1310, 1411, 1512, 1614, 1715, 1817,
	1919, 2021, 2123, 2225, 2328, 2430, 2533, 2636, 2739, 2843, 2947, 3050, 3155, 3259, 3364, 3469, 3574, 3679, 3785, 3891, 3997,
	4104, 4211, 4318, 4426, 4534, 4642, 4751, 4860, 4970, 5080, 5190, 5301, 5413, 5524, 5636, 5749, 5862, 5976, 6090, 6205, 6320,
	6436, 6552, 6669, 6786, 6905, 7023, 7143, 7263, 7383, 7504, 7626, 7749, 7872, 7997, 8121, 8247, 8373, 8501, 8629, 8757, 8887,
	9018, 9149, 9281, 9415, 9549, 9684, 9820, 9957, 10096, 10235, 10375, 10516, 10659, 10803, 10947, 11093, 11241, 11389, 11539,
	11690, 11842, 11996, 12151, 12308, 12466, 12625, 12786, 12949, 13113, 13279, 13446, 13615, 13786, 13959, 14133, 14309, 14487,
	14667, 14850, 15034, 15220, 15408, 15599, 15792, 15987, 16184, 16384, 16586, 16791, 16999, 17209, 17421, 17637, 17856, 18077,
	18301, 18529, 18760, 18994, 19231, 19472, 19716, 19964, 20216, 20471, 20731, 20994, 21262, 21534, 21810, 22091, 22377, 22667,
	22963, 23263, 23569, 23881, 24198, 24520, 24849, 25184, 25525, 25873, 26228, 26590, 26959, 27335, 27719, 28112, 28512, 28922,
	29340, 29768, 30205, 30652, 31110, 31578, 32058, 32549, 33053, 33569, 34098, 34641, 35198, 35770, 36358, 36962, 37582, 38221,
	38878, 39554, 40251, 40969, 41710, 42474, 43263, 44077, 44919, 45790, 46691, 47625, 48592, 49595, 50636, 51717, 52841, 54011,
	55228, 56498, 57822, 59204, 60649, 62162, 63747, 65409, 67154, 68990, 70923, 72961, 75114, 77392, 79806, 82368, 85093, 87998,
	91101, 94423, 97989, 101826, 105968, 110452, 115323, 120634, 126447, 132838, 139898, 147739, 156499, 166350, 177509, 190258,
	204962, 222112, 242375, 266682, 296385, 333504, 381219, 444828, 533868, 667410, 889958, 1335021, 2670143, 10680572}; //Scaled by 16384


int16_t app_sin(int32_t angle){
	angle %= 36000;
	while(angle<0){angle += 36000;}
	return arm_sin_q15((q15_t)(angle*32768/36000));
}	
	
int16_t app_cos(int32_t angle){
	angle %= 36000;
	while(angle<0){angle += 36000;}
	
	return arm_cos_q15((q15_t)(angle*32768/36000));
}
	
__INLINE static int32_t guess_tan(int32_t in) {
	uint8_t ini_index = in * 256 / 9000;
	int16_t weight = in*256 - (ini_index * 9000);
	return tan_table[ini_index] + (tan_table[ini_index + 1] - tan_table[ini_index])*weight / 9000;
}

int32_t app_tan(int32_t in){
	while(in > 18000){in -= 18000;}
	while(in < 0){in += 18000;}
	
	if (in < 9000){
		return guess_tan(in);
	}else{
		return -guess_tan(18000-in);
	}
}

int32_t app_asin(int32_t in){
	return (int32_t)(asinf(in*0.000030517578125f)*5729.57795131f + 0.5f);
}

int32_t app_acos(int32_t in){
	return (int32_t)(acosf(in*0.000030517578125f)*5729.57795131f + 0.5f);
}

int32_t app_atan(int32_t in){
	return (int32_t)(atanf(in*0.00006103515625f)*5729.57795131f + 0.5f);
}

int32_t app_atan2(int32_t y, int32_t x){
	return (int32_t)(atan2f(y*0.00006103515625f, x*0.00006103515625f)*5729.57795131f + 0.5f);
}
